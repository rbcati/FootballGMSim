<!DOCTYPE html>
<html>
<head>
    <title>FootballDB Test</title>
</head>
<body>
    <h1>FootballDB Test</h1>
    <div id="result">Running...</div>
    <script type="module">
        import { FootballDB } from './football-db.js';

        async function runTest() {
            const resultDiv = document.getElementById('result');
            try {
                // Use a test DB name to avoid messing with main DB if any
                const db = new FootballDB("test_football_db_" + Date.now());

                // Wait for connection
                await db.initPromise;

                console.log("Adding mock data...");
                await db.addPlayer(1, 'Harris');
                await db.addGame(100, 2025);

                console.log("Logging plays...");
                await db.logPlay(100, 1, 'run', 5);
                await db.logPlay(100, 1, 'run', 12);
                await db.logPlay(100, 1, 'run', -2);

                console.log("Finalizing season...");
                await db.finalizeSeason(2025);

                console.log("Verifying stats...");
                const stats = await db.getSeasonStats(1, 2025);

                if (stats && stats.rush_yards === 15) {
                    resultDiv.textContent = "SUCCESS";
                    console.log("Test Passed!");
                } else {
                    resultDiv.textContent = `FAILURE: Expected 15 yards, got ${stats ? stats.rush_yards : 'null'}`;
                    console.error("Test Failed", stats);
                }

                db.close();
            } catch (e) {
                resultDiv.textContent = "FAILURE: " + e.message;
                console.error(e);
            }
        }

        runTest();
    </script>
</body>
</html>
